{% extends 'layouts/enroll_main.html' %}

{% block title %} Student Management System {% endblock title %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}.
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<style>
	.form-group.row.control-label:after{
		content: "*";
		color: red;
	}
</style>
{% endblock stylesheets %}

{% block content %}
<div class="container">

	<ol class="breadcrumb ">
		<li><a href="{{url_for('home_blueprint.route_default')}}"><i class="fa fa-home" style="font-size: 15px;">
					Home</i></a></li>
		<li class="active" style="font-size: 13px;">Student Registration</li>
	</ol>
	<hr style="position: relative; top: 3px; border: none; height: 2px; background: black;">				
	<h4 class="well">
		<img src="../static/admin_images/faces/uahead.png">
		<hr>
		<b>Classes X, XI & XII and General Provisional Admission-2022</b>
		<br>
		<br>
		<div class="form-group ">
			<div class="row ">
				<div class="col-md-3">
					<div class="form-check form-check-inline">
						<label for="class_select">X  </label>
						<input class="form-check-input" type="radio" name="class_select" id="X" value="X">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-check form-check-inline">
						<label for="class_select">XI  </label>
						<input class="form-check-input" type="radio" name="class_select" id="XI" value="XI">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-check form-check-inline">
						<label for="class_select">XII  </label>
						<input class="form-check-input" type="radio" name="class_select" id="XII" value="XII">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-check form-check-inline">
						<label for="class_select">General</label>
						<input class="form-check-input" type="radio" name="class_select" id="General" value="general">
					</div>
				</div>
			</div>
		</div>
	</h4>

	<div class="col-lg-12 well form_title">
		<div class="row">
			<h2 class="text-center">Your form will appear here!</h2>
	    </div>
	</div> 

	<div class="col-lg-12 well form_title">
		<div class="row">
			<h3>The Available Seat for each class is listed below</h3>
	    </div>
		<div class="main-panel">
			<div class="content-wrapper">
				<div class="row">
					<div class="col-lg-12 grid-margin">
						<div class="card">
							<div class="card-body">
								<br>
								<h4 class="card-title">Student Slot List</h4>
								<hr>
								<div class="card-body">
									<div class="row">
										<div class="table-responsive">
											<table class="table align-items-center table-flush" id="customerList">
												<thead class="thead-light">
													<tr>
														<th scope="col"  class="fs-5">Class 7</th>
														<th scope="col"  class="fs-5">Class 8</th>
														<th scope="col"  class="fs-5">Class 9</th>
														<th scope="col"  class="fs-5">Class 10</th>
													</tr>
												</thead>
												<tbody class="fs-5">
													{% for row in slot %}
													<tr>
														<td>{{ row.class7 }}</td>
														<td>{{ row.class8 }}</td>
														<td>{{ row.class9 }}</td>
														<td>{{ row.class10 }}</td>
													</tr>
													{% endfor %}												</tbody>
											</table>
											<br><br>
										</div>
									</div>
									<div class="row">
										<div class="table-responsive">
											<table class="table align-items-center table-flush" id="customerList">
												<thead class="thead-light">
													<tr>
														<th scope="col"  class="fs-5">Class 11 Arts</th>
														<th scope="col"  class="fs-5">Class 11 Com</th>
														<th scope="col"  class="fs-5">Class 11 Sci</th>
													</tr>
												</thead>
												<tbody class="fs-5">
													{% for row in slot %}
													<tr>
														<td>{{ row.class11_arts }}</td>
														<td>{{ row.class11_com }}</td>
														<td>{{ row.class11_sci }}</td>
													</tr>
													{% endfor %}													</tbody>
											</table>
											<br><br>
										</div>
									</div>
									<div class="row">
										<div class="table-responsive">
											<table class="table align-items-center table-flush" id="customerList">
												<thead class="thead-light">
													<tr>
														<th scope="col"  class="fs-5">Class 12 Arts</th>
														<th scope="col"  class="fs-5">Class 12 Com</th>
														<th scope="col"  class="fs-5">Class 12 Sci</th>
													</tr>
												</thead>
												<tbody class="fs-5">
													{% for row in slot %}
													<tr>
														<td>{{ row.class12_arts }}</td>
														<td>{{ row.class12_com }}</td>
														<td>{{ row.class12_sci }}</td>
													</tr>
													{% endfor %}													</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
				
	</div> 

    <!-- enddddd -->
	<div class="col-lg-12 well form_std d-none">
		<h4 class="text-center grade_x_title">Registration for class X</h4>
		<h4 class="text-center grade_xi">Registration for class XI</h4>
		<h4 class="text-center grade_xii">Registration for class XII</h4>
		<h4 class="text-center general_grade">Registration for General (VII - IX)</h4>
		<div class="row">
			<form method="POST" id="registration_form" action="" enctype="multipart/form-data">
				<div class="p-1 mb-2 mt-3 bg-primary" style="font-weight: 500;
				font-size: 13px; text-align:center">Student's Personal Detail</div>
				<!-- student's detail -->
				<br><br>
				<div class="student">
					<div class="row">
						<div class="col-md-6">
							<div class="form-group row">
								<label for="cid" class="control-label col-sm-4 text-right" >citizenship identity card :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter CID" class="form-control" name="cid" id="cid">
									<small class="text-muted">If you don't have CID, put your student or EMIS code  </small>
									<div id="cid-message" style="color: red;"></div>
									<div id="cid-success" style="color: green;"></div>
								</div>
							</div>
							
							<div class="form-group row">
								<label for="DOB" class="control-label col-sm-4 text-right" >Date Of Birth :</label>
								<div class="col-sm-8">
									<input type="date" placeholder="Enter DOB" class="form-control" name="dob" id="dob">
								</div>
							</div>
							<div class="form-group row">
								<label for="gender" class="control-label col-sm-4 text-right" >Gender :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" name="gender" id="gender">
										<option value="">---Select One---</option>
										<option value="Male">Male</option>
										<option value="Female">Female</option>
										<option value="Others">Others</option>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label for="email_address" class="control-label col-sm-4 text-right">Email Address :</label>
								<div class="col-sm-8">
									<input type="email" placeholder="Enter email" class="form-control" name="email" id="email">
								</div>
							</div>
							<div class="form-group row">
								<label for="email_address" class="control-label col-sm-4 text-right">Phone Number :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter Phone Number" class="form-control" name="phone_number" maxlength="8"
									id="phone_number">							
								</div>
							</div>
							<div class="form-group row">
								<label for="half_photo" class="control-label col-sm-4 text-right">Upload Passport Size Photo (image) :</label>
								<div class="col-sm-8">
									<input type="file" class="form-control rounded-2" name="half_photo" id="half_photo" accept="image/jpeg, image/jpg, image/png" required/>
									<small class="text-muted">Allowed formats: JPEG, JPG, PNG. Max file size: 2MB</small>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group row">
								<label for="cid" class="control-label col-sm-4 text-right" >Student Code :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter The Student Code" class="form-control" name="student_code" id="student_code">
									<small class="text-muted">If you don't have student code, put your CID</small>
								</div>
							</div>
							<div class="form-group row">
								<label for="firstname" class="control-label col-sm-4 text-right" class="form-control-label">First Name :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter First Name" class="form-control" name="first_name" id="first_name">
								</div>
							</div>
							<div class="form-group row">
								<label for="lastname" class="control-label col-sm-4 text-right" >Last Name :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter Last Name" class="form-control" name="last_name" id="last_name">
								</div>
							</div>
							<div class="form-group row">
								<label for="Dzongkhag" class="control-label col-sm-4 text-right" >Dzongkhag :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" name="permanent_dzongkhag"
									id="permanent_dzongkhag">
									<option value="">---Select Dzongkhag---</option>
									{% for row in dzo_List %}
									<option value="{{ row.dzo_id }}">{{ row.dzo_name }}</option>
									{% endfor %}
								</select>
								</div>
							</div>
							<div class="form-group row">
								<label for="permanent_gewog" class="control-label col-sm-4 text-right">Gewog :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" id="permanent_gewog" name="permanent_gewog">
										<option value="">---Select Gewog---</option>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label for="permanent_village" class="control-label col-sm-4 text-right">Village :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" id="permanent_village" name="permanent_village">
										<option value="">---Select Village---</option>
									</select>
								</div>
							</div>
						</div>	
					</div>
				</div>
				<!-- ends student's details -->
				<!-- Academic details -->
				<div class="p-1 mb-2 mt-3 bg-primary" style="font-weight: 500; font-size: 13px; text-align:center;">Academic Detail</div> <br><br>
				<div class="academic">
					<div class="row ">
						<div class="col-md-6">
							<div class="form-group row">
								<label for="indexnumber" class="control-label col-sm-4 text-right" class="form-control-label">Index Number :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter Index Number" class="form-control" name="index_number"id="index_number">
								</div>
							</div>
							
							<div class="form-group row pre_school">
								<label for="PreviouSchool" class="control-label col-sm-4 text-right" >Previous School :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter Previous School Name" class="form-control" name="previous_school" id="previous_school">
									<!-- <div class="invalid-feedback" id="previousSchoolError">The Previous school is required.</div> -->
								</div>
							</div>
							
							<div class="form-group row">
								<label for="supw" class="control-label col-sm-4 text-right">SUPW :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" name="supw" id="supw">
										<option value="">---Select Supw---</option>
										<option value="A">A</option>
										<option value="B">B</option>
										<option value="C">C</option>
										<option value="D">D</option>
									</select>
									<!-- <div class="invalid-feedback" id="previousSchoolError">The Previous school is required.</div> -->
								</div>
							</div>
							
							<!-- <hr style="width: 600px;margin: 0 30px;">
							<div class="form-group row pre_school_XII d-none">
								<p>If you are a repeater fill up the following</p>
								<label for="BHSEC" class="control-label col-sm-4 text-right" >BHSEC (Class XII) :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter Previous School Name" class="form-control" name="previous_school_XII" id="previous_school_XII">
								</div>
							</div> -->
						</div>
						<div class="col-md-6">
							<div class="form-group row emis_code d-none">
								<label for="stdcode" class="control-label col-sm-4 text-right" class="form-control-label">Student Code (EMIS code) :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter student code" class="form-control" name="std_code" id="std_code">
								</div>
							</div>
							<div class="form-group row pre_school_X d-none">
								<label for="cid" class="control-label col-sm-4 text-right" >Previous School Name</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter School Name" class="form-control"name="previous_school_X" id="previous_school_X">
								</div>
							</div>
							
							<div class="form-group row admission_for">
								<label for="DOB" class="control-label col-sm-4 text-right" >Admission for? (Enter class) :</label>
								<div class="col-sm-8">
									<select class="form-control form-select" name="admission_for" id="admission_for">
										<option value="">---Select One---</option>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label for="PreviouSchool" class="control-label col-sm-4 text-right" >Percentage(%) :</label>
								<div class="col-sm-8">
									<input type="text" placeholder="Enter percentage obtained" class="form-control" name="percent" id="percent">
								</div>
							</div>
							<div class="form-group row">
								<label for="result" class="control-label col-sm-4 text-right" class="form-control-label" >Upload Marksheet/result (image) :</label>
								<div class="col-sm-8">
									<input type="file" class="form-control rounded-2" name="marksheet" id="marksheet" accept=".doc, .docx, .pdf" />
									<small class="text-muted">Allowed formats: DOC, DOCX, PDF. Max file size: 5MB</small>
								</div>
							</div>
						</div>	
					</div>
				</div>
				<!-- Academic detail end -->
				<div class=" p-1 mb-2 mt-3 bg-primary" style="font-weight: 500;font-size: 13px; text-align:center;">Parent's/gaurdian's Detail</div> <br><br>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group row">
							<label for="parent_cid" class="control-label col-sm-4 text-right" class="form-control-label">citizenship ID :</label>
							<div class="col-sm-8">
								<input type="text" placeholder="Enter Parent/gaurdian's CID" class="form-control" name="parent_cid"id="parent_cid">
								<span><b>If you don't have CID, put your child's EMIS code  </b></span>

							</div>
						</div>
						<div class="form-group row">
							<label for="phone_number" class="control-label col-sm-4 text-right" class="form-control-label">Phone Number :</label>
							<div class="col-sm-8">
								<input type="text" placeholder="Enter Parent's Number" class="form-control" name="parent_number"id="parent_number" maxlength="8">
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group row">
							<label for="Name" class="control-label col-sm-4 text-right" >Name :</label>
							<div class="col-sm-8">
								<input type="text" placeholder="Enter Parent/gaurdian Name" class="form-control" name="parent_name"id="parent_name">
							</div>
						</div>
						<div class="form-group row">
							<label for="email" class="control-label col-sm-4 text-right" > Email Address :</label>
							<div class="col-sm-8">
								<input type="email" placeholder="Enter Parent's Email" class="form-control" name="parent_email"id="parent_email">
							</div>
						</div>
					</div>
				</div>
				<!-- present address -->
				<div class=" p-1 mb-2 mt-3 bg-primary" style="font-weight: 500; font-size: 13px; text-align: center;">Present Address Detail</div> <br><br>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group row">
							<label for="present_dzongkhag" class="control-label col-sm-4 text-right" class="pull-left form-label">Dzongkhag :</label>
							<div class="col-sm-8">
								<select class="form-control form-select" name="present_dzongkhag" id="present_dzongkhag">
									<option value="">---Select Dzongkhag---</option>
									{% for row in dzo_List %}
									<option value="{{ row.dzo_id }}">{{ row.dzo_name }}</option>
									{% endfor %}
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label for="present_village" class="control-label col-sm-4 text-right" class="pull-left form-label">Village :</label>
							<div class="col-sm-8">
								<select class="form-control form-select" id="present_village" name="present_village">
									<option value="">---Select Village---</option>
								</select>			
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group row">
							<label for="present_gewog" class="control-label col-sm-4 text-right" class="pull-left form-label">Gewog :</label>
							<div class="col-sm-8">
								<select class="form-control form-select" id="present_gewog" name="present_gewog">
									<option value="">---Select Gewog---</option>
								</select>					</div>
						</div>
						
					</div>
				</div>
				<!-- accomodation details -->
				<div class=" p-1 mb-2 mt-3 bg-primary" style="font-weight: 500; font-size: 13px; text-align: center;">Accommodation Detail </div> <br><br>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group row">
							<label for="gender" class="control-label col-sm-4 text-right" >Accommodation (if admitted) :</label>
							<div class="col-sm-8">
								<select class="form-control form-select" name="accommodation" id="accommodation">
									<option value="">---Select One---</option>
									<option value="Boarder">Boarder</option>
									<option value="Day student">Day student</option>
									<option value="Paying guest">Paying guest</option>
								</select>
							</div>
						</div>	
					</div>
					
					<div class="linkfee">
						<h5>Fees need to be paid only if you have approved your admission, <a href="{{url_for('home_blueprint.studentFee')}}">click here</a> to know more detail about fees.</h5>
					</div>
				</div>
				<!-- end accumodation detail -->
				<div class="button-center">
					<button type="submit" class="btn btn-sm btn-warning student_reg" style="color: white;width: 101px;height: 40px;font-size: 16px;" id="submitBtn">Submit</button>
				</div>
		    </form>
	    </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js" integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
	// Get the value of the CID input field
var cid = document.getElementById('cid').value;

// For checking the CID inside the database
$(document).ready(function() {
    $('#cid').keyup(function() {
        var cid = $(this).val();
        // Send an AJAX request to check if CID exists
        $.ajax({
            url: '/check_std_cid/' + cid, // Adjust the URL pattern here
            method: 'GET',
            success: function(response) {
                if (response.exists) {
					var gewog_id = response.permanent_gewog;
                    // CID exists, populate other fields
                    $('#gender').val(response.gender);
                    $('#first_name').val(response.first_name);
                    $('#last_name').val(response.last_name);
                    $('#email').val(response.email);
                    $('#dob').val(response.dob);
                    $('#phone_number').val(response.phone_number);
                    $('#permanent_dzongkhag').val(response.permanent_dzongkhag);
					$('#cid-message').text('CID found! Please change the CID').css('color', 'red').show();
                    $('#cid-success').text('CID Valid').addClass('text-success').hide(); // Corrected typo: 'text-success'
					$('#submitBtn').hide();
					$.ajax({
						url: "/get-gewog-list-std",
						method: "POST",
						data: { type: 'Gewog', gewog_id: gewog_id },
						dataType: "json",
						success: function (data) {

							var list = data.gewogList;
							var html = "<option value=''>---Select Gewog---</option>";
							for (var count = 0; count < list.length; count++) {
								html += "<option value='" + list[count].gewog_id + "'>" + list[count].gewog_name + "</option>"
							}
							$("#permanent_gewog").html(html);
							$('#permanent_gewog').val(response.permanent_gewog);
						},
						error: function () {
							alert('error');
						}
					});
					var village_id = response.permanent_village;
					$.ajax({
						url: "/get-village-list-std",
						method: "POST",
						data: { type: 'village', village_id: village_id },
						dataType: "json",
						success: function (data) {
							var list = data.villageList
							var html = "<option value=''>---Select Village---</option>";
							for (var count = 0; count < list.length; count++) {
								html += "<option value='" + list[count].village_id + "'>" + list[count].village_name + "</option>"
							}
							$("#permanent_village").html(html);
							$('#permanent_village').val(response.permanent_village);
						},
						error: function () {
							alert('error');
						}
					});
                } else {
                    // CID does not exist, hide any previous messages
                    $('#cid-success').text('CID Valid').addClass('text-success').show();
                    $('#cid-message').text('CID not found.').addClass('text-success').hide(); // Corrected class and message
					$('#submitBtn').show();
                }
            }
        });
    });
});
</script>
<script>
    // JavaScript to check file size
    document.getElementById('half_photo').addEventListener('change', function() {
        var fileInput = this;
        var maxSize = 2 * 1024 * 1024; // 2MB
        if (fileInput.files.length > 0) {
            var fileSize = fileInput.files[0].size;
            if (fileSize > maxSize) {
				Swal.fire({
					title: "Passport Size Exceeded",
					text: "File size exceeds the limit of 2MB",
					icon: "error"
					});
                fileInput.value = ''; // Clear the file input
            }
        }
    });
	 // JavaScript to check file size
	 document.getElementById('marksheet').addEventListener('change', function() {
        var fileInput = this;
        var maxSize = 5 * 1024 * 1024; // 5MB
        if (fileInput.files.length > 0) {
            var fileSize = fileInput.files[0].size;
            if (fileSize > maxSize) {
				Swal.fire({
					title: "Size Exceeded",
					text: "File size exceeds the limit of 5MB",
					icon: "error"
					});
                fileInput.value = ''; // Clear the file input
            }
        }
    });
</script>
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}

<!--<script src="static/js/student_enroll_validation.js" type="text/javascript"></script>-->
<!--<script src="{{ url_for('static', filename='js/student_enroll_validation.js') }}"></script>-->

{% endblock javascripts %}